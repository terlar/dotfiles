#!/usr/bin/env bash
if [ $# -eq 0 ]; then
	firefox &>/dev/null
	exit 0
fi

url="$*"
curl_opts=(-s)

if [ -f $HOME/.slackcurl/team_id -a -f $HOME/.slackcurl/cookies ]; then
	team_id=$(cat ~/.slackcurl/team_id)

	if [[ "$url" == https://*.slack.com/files/* ]]; then
		url=$(echo $url | sed 's|\(https://\).*\.\(slack\.com\)/files/.*/\(.*\)/\(.*\)|\1files.\2/files-pri/'$team_id'-\3/\4|')
		curl_opts+=(--cookie ~/.slackcurl/cookies)
	fi
fi

mime=$(curl ${curl_opts[@]} -IX HEAD "$url" | grep '^Content-Type:' | cut -d' ' -f2)
case "$mime" in
	image/*)
		curl ${curl_opts[@]} $url | feh -. -
		;;
	*)
		xdg-open $url &>/dev/null
		;;
esac
