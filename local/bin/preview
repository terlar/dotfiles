#!/usr/bin/env bash
main() {
	local no_browser

	while true ; do
		case "$1" in
			-n)
				no_browser=1
				shift 1
			;;
			*)
				break
			;;
		esac
	done

	local file="$*"
	local cmd='awk 1 ORS="<br>"'

	case "$file" in
		*.rst)
			if command -v rst2html >/dev/null; then
				cmd=rst2html
			fi
			;;
		*.md)
			if command -v pandoc >/dev/null; then
				cmd='pandoc -s'
			elif command -v marked >/dev/null; then
				cmd=marked
			fi
			;;
	esac

	if [[ "$no_browser" = 1 ]] ; then
		eval $cmd "'$file'"
	else
		eval $cmd "'$file'" | browser
	fi
}

main "$@"
