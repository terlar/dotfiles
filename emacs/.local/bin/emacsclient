#!/usr/bin/env bash
[[ "${TRACE}" ]] && set -x
set -eu
set -o pipefail

is_editor_running() {
	xprop -name editor &>/dev/null
}

is_graphical() {
	[ -n "${DISPLAY:-}" ]
}

is_interactive() {
	fd=0 # stdin
	[ -t "${fd}" ] || [ -p /dev/stdin ]
}

has_xdotool() {
	command -v xdotool &>/dev/null
}

main() {
	# Open editor window if not available
	if ! is_editor_running
	then
		exec /usr/bin/emacsclient -c -F '((name . "editor"))' "$@"
	fi

	if is_interactive && is_graphical
	then
		# Switch to editor window
		has_xdotool && xdotool key 'Super+E'

		if [ "$#" -eq 0 ]
		then
			return
		fi
	fi

	exec /usr/bin/emacsclient "$@"
}

main "$@"
