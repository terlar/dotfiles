#!/usr/bin/env bash
[[ "${TRACE}" ]] && set -x
set -eu
set -o pipefail

is_graphical() {
	[ -n "${DISPLAY:-}" ]
}

is_interactive() {
	fd=0 # stdin
	[ -t "${fd}" ] || [ -p /dev/stdin ]
}

has_xdotool() {
	command -v xdotool &>/dev/null
}

current_desktop() {
	xdotool get_desktop
}

bring_and_raise_window() {
	has_xdotool || return

	local wmname desktop
	wmname="${1?window name not provided}"
	desktop="$(current_desktop)"

	xdotool search --name "${wmname}" set_desktop_for_window "${desktop}" windowactivate
}

has_window() {
	local wmname="${1?window name not provided}"

	xprop -name "${wmname}" &>/dev/null
}

main() {
	if is_graphical
	then
		local wmname="editor"

		# Open editor window if not available
		if has_window "${wmname}"
		then
			bring_and_raise_window "${wmname}"
		else
			exec /usr/bin/emacsclient -c -F "((name . \"${wmname}\"))" "$@"
		fi
	fi

	exec /usr/bin/emacsclient "$@"
}

main "$@"
